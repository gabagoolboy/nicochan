<script type="text/javascript">
	var active_page = "mod";
</script>
<script src="js/id_colors.js"></script>

{% for board_posts in posts %}
	<fieldset>
		<legend>
			<a href="?/{{ config.board_path|format(board_posts.board.uri) }}{{ config.file_index }}">
				{{ config.board_abbreviation|format(board_posts.board.uri) }}
				 -
				 {{ board_posts.board.title|e }}
			</a>
		</legend>
		{{ board_posts.posts|join('<hr>') }}
	</fieldset>
{% endfor %}



{% if mod|hasPermission(config.mod.view_notes) %}
	<fieldset id="notes">
		<legend>
			{% set notes_on_record = 'note' ~ (notes|length > 1 ? 's' : '') ~ ' on record' %}
			<legend>{{ notes|length }} {% trans %} {{notes_on_record}}{% endtrans %}</legend>
		</legend>

		{% if notes|length > 0 %}
			<table class="modlog">
				<tr>
					<th>{% trans 'Staff' %}</th>
					<th>{% trans 'Note' %}</th>
					<th>{% trans 'Date' %}</th>
					{% if mod|hasPermission(config.mod.remove_notes) %}
						<th>{% trans 'Actions' %}</th>
					{% endif %}
				</tr>
				{% for note in notes %}
					<tr>
						<td class="minimal">
							{% if note.username %}
								<a href="?/new_PM/{{ note.username|e }}">{{ note.username|e }}</a>
							{% else %}
								<em>{% trans 'deleted?' %}</em>
							{% endif %}
						</td>
						<td>
							{{ note.body }}
						</td>
						<td class="minimal">
							{{ note.time|strftime }}
						</td>
						{% if mod|hasPermission(config.mod.remove_notes) %}
							<td class="minimal">
								<a href="?/IP/{{ ip|url_encode(true) }}/remove_note/{{ note.id }}">
									<small>[{% trans 'remove' %}]</small>
								</a>
							</td>
						{% endif %}
					</tr>
				{% endfor %}
			</table>
		{% endif %}

		{% if mod|hasPermission(config.mod.create_notes) %}
			<form action="" method="post" style="margin:0">
				<input type="hidden" name="token" value="{{ security_token }}">
				<table>
					<tr>
						<th>{% trans 'Staff' %}</th>
						<td>{{ mod.username|e }}</td>
					</tr>
					<tr>
						<th>
							<label for="note">{% trans 'Note' %}</label>
						</th>
						<td>
							<textarea id="note" name="note" rows="5" cols="30"></textarea>
						</td>
					</tr>
					<tr>
						<td></td>
						<td><input type="submit" value="{% trans 'New note' %}"></td>
					</tr>
				</table>
			</form>
		{% endif %}
	</fieldset>
{% endif %}


{% if mod|hasPermission(config.mod.forcedflag) %}
	<fieldset id="forcedflag">
		<legend>
			<legend>{% trans 'Set custom user flag' %}</legend>
		</legend>

		{% if is_forcedflag %}
			<form action="" method="post" style="text-align:center; margin:0">
				<b>{% trans 'Fucking' %} {{ is_forcedflag }}</b><br/>
				<input type="hidden" name="token" value="{{ security_token }}">
				<input type="submit" name="remove_forcedflag" value="{% trans 'Remove' %} {{ is_forcedflag }} {% trans 'Flag' %}">
			</form>
		{% else %}
			<form action="" method="post"  style="text-align:center; margin:0">
				<input type="hidden" name="token" value="{{ security_token }}">

				{% trans 'Make IP fucking ' %}
				<select name="country" id="country">
					<option selected="selected">Choose one</option>
					{% for country in countries %}
						<option value="{{ country.id|e }}">{{ country.name|e }}</option>
					{% endfor %}
				</select>

				<input type="submit" name="set_forcedflag" value="{% trans 'Make it so' %}">
			</form>
		{% endif %}
	</fieldset>
{% endif %}



{% if bans|length > 0 and mod|hasPermission(config.mod.view_ban) %}
	<fieldset id="bans">
		{% set bans_on_record = 'ban' ~ (bans|length > 1 ? 's' : '') ~ ' on record' %}
		<legend>{{ bans|length }} {% trans %} {{bans_on_record}} {% endtrans %}</legend>

		{% for ban in bans %}
			<form action="" method="post" style="text-align:center">
				<input type="hidden" name="token" value="{{ security_token }}">
				<table style="width:400px;margin-bottom:10px;border-bottom:1px solid #ddd;padding:5px">
					<tr>
						<th>{% trans 'Status' %}</th>
						<td>
							{% if config.mod.view_banexpired and ban.expires != 0 and ban.expires < time() %}
								{% trans 'Expired' %}
							{% else %}
								{% trans 'Active' %}
							{% endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'IP' %}</th>
						<td>{{ ban.mask }}</td>
					</tr>
					<tr>
						<th>Cookie</th>
						<td>
							{%  if ban.cookiebanned %}
								<s style="background-color: #F33">{{ ban.cookie }}</s>
							{%  else %}
								{{ ban.cookie }}
							{%  endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'Reason' %}</th>
						<td>
							{% if ban.reason %}
								{{ ban.reason }}
							{% else %}
								<em>{% trans 'no reason' %}</em>
							{% endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'Board' %}</th>
						<td>
							{% if ban.board %}
								{{ config.board_abbreviation|format(ban.board) }}
							{% else %}
								<em>{% trans 'all boards' %}</em>
							{% endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'Set' %}</th>
						<td>{{ ban.created|strftime }}</td>
					</tr>
					<tr>
						<th>{% trans 'Expires' %}</th>
						<td>
							{% if ban.expires %}
								{{ ban.expires|strftime }}
							{% else %}
								<em>{% trans 'never' %}</em>
							{% endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'Seen' %}</th>
						<td>
							{%  if ban.seen %}
								{% trans 'Yes' %}
							{%  else %}
								{% trans 'No' %}
							{%  endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'Staff' %}</th>
						<td>
							{% if ban.username %}
								{{ ban.username|e }}
							{% else %}
								<em>{% trans 'deleted?' %}</em>
							{% endif %}
						</td>
					</tr>
					<tr>
						<th>{% trans 'Appealable' %}</th>
						<td>
						{{ ban.appealable ? 'Yes' : 'No' }}
						</td>
					</tr>
				</table>
				<input type="hidden" name="ban_id" value="{{ ban.id }}">
				<input type="hidden" name="appeal" value="{{ ban.appealable }}">
				<input type="submit" name="ban_cookie" value="Ban Cookie">
				<input type="submit" name="change_appeal" value="Change appeal">
				<input type="submit" name="unban" value="{% trans 'Remove ban' %}">
			</form>
		{% endfor %}
	</fieldset>
{% endif %}

{% if mod|hasPermission(config.mod.ban) %}
	<fieldset>
		<legend>{% trans 'New ban' %}</legend>
		{% set redirect = '?/IP/' ~ ip ~ '#bans' %}
		{% include 'mod/ban_form.html' %}
	</fieldset>
{% endif %}

{% if logs|length > 0  %}
	<fieldset id="history">
		<legend>History</legend>
		<table class="modlog" style="width:100%">
			<tr>
				<th>{% trans 'Staff' %}</th>
				<th>{% trans 'Time' %}</th>
				<th>{% trans 'Board' %}</th>
				<th>{% trans 'Action' %}</th>
			</tr>
			{% for log in logs %}
				<tr>
					<td class="minimal">
						{% if log.username %}
							<a href="?/log:{{ log.username|e }}">{{ log.username|e }}</a>
						{% elseif log.mod == -1 %}
							<em>system</em>
						{% else %}
							<em>{% trans 'deleted?' %}</em>
						{% endif %}
					</td>
					<td class="minimal">
						<span title="{{ log.time|strftime }}">{{ log.time|ago }}</span>
					</td>
					<td class="minimal">
						{% if log.board %}
							<a href="?/{{ config.board_path|format(log.board) }}{{ config.file_index }}">{{ config.board_abbreviation|format(log.board) }}</a>
						{% else %}
							-
						{% endif %}
					</td>
					<td>
						{{ log.text }}
					</td>
				</tr>
			{% endfor %}
		</table>
	</fieldset>
{% endif %}
